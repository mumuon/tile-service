version: '3.8'

services:
  tile-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: drivefinder-tile-service
    env_file: .env
    environment:
      - WORKERS=4
      - POLL_INTERVAL_SECONDS=10
    volumes:
      # Mount curvature data directory
      - ./curvature-data:/app/curvature-data:ro
      # Mount output tiles directory
      - ./public/tiles:/app/public/tiles:rw
    restart: unless-stopped
    healthcheck:
      test: ['CMD', 'ps', 'aux']
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: 'json-file'
      options:
        max-size: '10m'
        max-file: '3'
    # Optional: Uncomment to add resource limits
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2'
    #       memory: 2G
    #     reservations:
    #       cpus: '1'
    #       memory: 1G
